import{g as L,o as j,a as E,n as z,u as T,b as M,r as x,w as W,c as N,s as A,d as B,e as D,f as S,V as F,h as g,i as k,t as I,j as C}from"./index-BcIBdyOV.js";import{u as R}from"./list-CjBsJzAm.js";import{u as q}from"./settings-DfcK55zI.js";import{V as P,a as H}from"./VRow-BAjd3698.js";function O(e){return L()?(j(e),!0):!1}function w(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const r=()=>t(o);return O(r),{off:r}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(r=>r(...o)))}}function U(e){return typeof e=="function"?e():T(e)}const $=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const J=Object.prototype.toString,K=e=>J.call(e)==="[object Object]",Q=()=>{};function X(e){return M()}function Y(e,t=!0,n){X()?E(e,n):t?e():z(e)}function Z(e){var t;const n=U(e);return(t=n==null?void 0:n.$el)!=null?t:n}const V=$?window:void 0;function ee(...e){let t,n,i,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,i,o]=e,t=V):[t,n,i,o]=e,!t)return Q;Array.isArray(n)||(n=[n]),Array.isArray(i)||(i=[i]);const r=[],s=()=>{r.forEach(l=>l()),r.length=0},p=(l,c,u,f)=>(l.addEventListener(c,u,f),()=>l.removeEventListener(c,u,f)),v=W(()=>[Z(t),U(o)],([l,c])=>{if(s(),!l)return;const u=K(c)?{...c}:c;r.push(...n.flatMap(f=>i.map(h=>p(l,f,h,u))))},{immediate:!0,flush:"post"}),m=()=>{v(),s()};return O(m),m}function te(){const e=x(!1),t=M();return t&&E(()=>{e.value=!0},t),e}function ne(e){const t=te();return N(()=>(t.value,!!e()))}function oe(e={}){const{window:t=V,requestPermissions:n=!0}=e,i=e,o=ne(()=>{if(!t||!("Notification"in t))return!1;try{new Notification("")}catch{return!1}return!0}),r=x(o.value&&"permission"in Notification&&Notification.permission==="granted"),s=x(null),p=async()=>{if(o.value)return!r.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(r.value=!0),r.value},{on:v,trigger:m}=w(),{on:l,trigger:c}=w(),{on:u,trigger:f}=w(),{on:h,trigger:b}=w(),_=async a=>{if(!o.value||!r.value)return;const d=Object.assign({},i,a);return s.value=new Notification(d.title||"",d),s.value.onclick=m,s.value.onshow=c,s.value.onerror=f,s.value.onclose=b,s.value},y=()=>{s.value&&s.value.close(),s.value=null};if(n&&Y(p),O(y),o.value&&t){const a=t.document;ee(a,"visibilitychange",d=>{d.preventDefault(),a.visibilityState==="visible"&&y()})}return{isSupported:o,notification:s,ensurePermissions:p,permissionGranted:r,show:_,close:y,onClick:v,onShow:l,onError:u,onClose:h}}const re={style:{"font-size":"2.5rem"}},se=k("h1",{class:"my-5"},"剩餘時間 ",-1),ie={style:{"font-size":"5em","font-family":"Comic Sans MS",width:"30%","border-radius":"15px",margin:"auto",border:"8px solid black"},class:"bg-grey-darken-3 opacity-60 my-5"},fe={__name:"index",setup(e){const t={STOP:0,COUNTING:1,PAUSE:2},n=x(t.STOP),i=R(),{currentItem:o,items:r,timeleft:s}=A(i),{setCurrentItem:p,countdown:v,setFinishItem:m}=i,l=q(),{selectedAlarmFile:c}=A(l);let u=0;const f=()=>{n.value===t.STOP&&r.value.length>0&&p(),n.value=t.COUNTING,u=setInterval(()=>{v(),s.value===0&&b()},1e3)},h=()=>{n.value=t.PAUSE,clearInterval(u)},b=()=>{clearInterval(u),n.value=t.STOP;const a=new Audio;a.src=c.value,a.play();const{show:d,isSupported:G}=oe({title:"事項完成",body:o.value,icon:new URL(""+new URL("tomato-tm_sgEMz.png",import.meta.url).href,import.meta.url).href});G.value&&d(),m(),r.value.length>0&&f()},_=N(()=>o.value.length>0?o.value:r.value.length>0?"點擊開始":"無"),y=N(()=>{const a=Math.floor(s.value/60).toString().padStart(2,"0"),d=(s.value%60).toString().padStart(2,"0");return a+":"+d});return(a,d)=>(B(),D(F,{class:""},{default:S(()=>[g(H,{class:"text-center my-8"},{default:S(()=>[g(P,{cols:"12",style:{color:"#212121"}},{default:S(()=>[k("h1",re,"目前事項 : "+I(_.value),1),se,k("div",ie,I(y.value),1)]),_:1}),g(P,{cols:"12"},{default:S(()=>[g(C,{icon:"mdi-play",onClick:f,disabled:n.value===t.COUNTING||T(o).length===0&&T(r).length===0,class:"bg-grey-darken-2 mx-2",variant:"elevated",style:{width:"60px",height:"60px","font-size":"2rem",border:"5px solid #727372"}},null,8,["disabled"]),g(C,{icon:"mdi-pause",disabled:n.value!==t.COUNTING,onClick:h,class:"bg-grey-darken-2 mx-2",variant:"elevated",style:{width:"60px",height:"60px","font-size":"2rem",border:"5px solid #727372"}},null,8,["disabled"]),g(C,{icon:"mdi-skip-next",disabled:T(o).length===0,onClick:b,class:"bg-grey-darken-2 mx-2",variant:"elevated",style:{width:"60px",height:"60px","font-size":"2rem",border:"5px solid #727372"}},null,8,["disabled"])]),_:1})]),_:1})]),_:1}))}};export{fe as default};
